{% extends "course_drapeau/base.html" %}
{% load static %}
{% load route %}
{% block title %}
    Parcours
{% endblock title %}
{% block content %}
    <section>
        <div class="btn-group adminView default-margin"
             role="group"
             aria-label="Basic radio toggle button group"
             id="troncons-switch">
            <input type="radio"
                   class="btn-check"
                   name="btnradio"
                   id="btnradio1"
                   onclick="changeView('map', 'tronconsListe')"
                   checked>
            <label class="btn btn-outline-primary" for="btnradio1">Liste</label>
            <input type="radio"
                   class="btn-check"
                   name="btnradio"
                   id="btnradio2"
                   onclick="changeView('tronconsListe', 'map'); add_gpx('{% url "fullsection" %}', 0)">
            <label class="btn btn-outline-primary" for="btnradio2">Visualisation parcours complet</label>
        </div>
        <div id="map"></div>
        <div id="tronconsListe">
            <table id="troncons-table" class="table table-striped table-hover">
                <tr>
                    <th>Numéro tronçon</th>
                    <th>Groupe de coureurs</th>
                    <th>Heure de départ</th>
                    <th>Point GPS de départ</th>
                    <th>Heure arrivée</th>
                    <th>Point GPS arrivée</th>
                    <th id="troncons-column-visualize">Voir sur la carte</th>
                    <th>Télécharger la trace</th>
                </tr>
                {% for trace in GPX_traces %}
                    {% gps_url trace as gps_url %}
                    {% coordinate trace as coordinate %}
                    {% group trace as group %}
                    <tr>
                        <td>{{ trace.id }}</td>
                        <td style="background-color: {{ group.color }};
                                   border-bottom-width: {{ group.bw }}">{{ group.name|default_if_none:"A venir" }}</td>
                        <td>{{ trace.datetime_start | date:"D j M, G:i" }}</td>
                        <td>
                            <a href={{ gps_url.start }} target="_blank">point départ</a>
                            <div id="hidden_start_{{ trace.id }}" class="d-none">{{ coordinate.start }}</div>
                            <button class="troncons-button">
                                <img class="troncons-icon"
                                     src="{% static 'course_drapeau/img/icons/clipboard.png' %}"
                                     alt="copy to clipboard"
                                     onclick="copier('hidden_start_{{ trace.id }}', 'Point GPS copié dans le presse-papier')"
                                     width="28px"
                                     height="auto">
                            </button>
                        </td>
                        <td>{{ trace.datetime_stop | date:"D j M, G:i" }}</td>
                        <td>
                            <a href={{ gps_url.stop }} target="_blank">point arrivée</a>
                            <div id="hidden_stop_{{ trace.id }}" class="d-none">{{ coordinate.stop }}</div>
                            <button class="troncons-button">
                                <img class="troncons-icon"
                                     src="{% static 'course_drapeau/img/icons/clipboard.png' %}"
                                     alt="copy to clipboard"
                                     onclick="copier('hidden_stop_{{ trace.id }}', 'Point GPS copié dans le presse-papier')"
                                     width="28px"
                                     height="auto">
                            </button>
                        </td>
                        <td>
                            <button class="troncons-button"
                                    onclick="changeView('troncons-table', 'carte'); add_gpx('{% url "section" trace.id %}', 1)">
                                Visualiser
                            </button>
                        </td>
                        <td>
                            <a href={% url "section" trace.id %} target="_blank">Télécharger</a>
                        </td>
                    </tr>
                {% endfor %}
            </table>
            <div id="carte">
                <button class="btn btn-primary ms-3"
                        onclick="changeView('carte', 'troncons-table')">Retourner à la liste</button>
                <div id="map2"></div>
            </div>
            <div id="cs-popup-area"></div>
        </div>
        <script src="{% static 'course_drapeau/js/map.js' %}"></script>
    </section>
{% endblock content %}
